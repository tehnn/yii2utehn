/*!
 * @copyright Copyright &copy; Kartik Visweswaran, Krajee.com, 2014
 * @package yii2-editable
 * @version 1.4.0
 *
 * Editable Extension jQuery plugin
 *
 * Built for Yii Framework 2.0
 * Author: Kartik Visweswaran
 * Year: 2014
 * For more Yii related demos visit http://demos.krajee.com
 */!function(e){var t=function(t,i){return null===t||void 0===t||t==[]||""===t||i&&""===e.trim(t)},i=function(e){return"undefined"!=typeof e&&null!=e&&null!=e.length&&e.length>0},o=function(t,i){this.$element=e(t),this.init(i),this.listen()};o.prototype={constructor:o,init:function(t){var i=this;i.$container=e("#"+t.containerId),i.$form=i.$container.find(".kv-editable-form"),i.$value=i.$container.find(".kv-editable-value"),i.$popover=i.$container.find(".kv-editable-popover"),i.$btnSubmit=i.$container.find("button.kv-editable-submit"),i.$btnReset=i.$container.find("button.kv-editable-reset"),i.$loading=i.$container.find(".kv-editable-loading"),i.$target=i.$container.find(t.target),i.valueIfNull=t.valueIfNull,i.placement=t.placement,i.displayValueConfig=t.displayValueConfig,i.showAjaxErrors=t.showAjaxErrors},refreshPosition:function(){var t,i=this,o=i.$popover,r=i.placement,a=i.$target,n=o[0].offsetWidth,l=o[0].offsetHeight,s=e.extend({},a.position(),{width:a[0].offsetWidth,height:a[0].offsetHeight});switch(r){case"bottom":t={top:s.top+s.height,left:s.left+s.width/2-n/2};break;case"top":t={top:s.top-l,left:s.left+s.width/2-n/2};break;case"left":t={top:s.top+s.height/2-l/2,left:s.left-n};break;case"right":t={top:s.top+s.height/2-l/2,left:s.left+s.width}}o.css(t)},listen:function(){var o,r=this,a=r.$form,n=r.$btnSubmit,l=r.$btnReset,s=a.parent(),d=r.$popover,c=r.$loading,f=r.$element,h=r.valueIfNull,u=f.closest(".field-"+f.attr("id")),p=f.parent(),v=u.find(".help-block"),m=r.displayValueConfig,b=a.find('input[name="hasEditable"]'),g=t(u.attr("class"))||t(v.attr("class"));o=function(i){var o=p.find(".kv-help-block");g?(t(o.attr("class"))&&(o=e(document.createElement("div")).attr({"class":"help-block kv-help-block"}).appendTo(p)),o.html(i),p.addClass("has-error")):(u.addClass("has-error"),v.html(i),v.removeClass("kv-help-block").addClass("kv-help-block")),c.hide(),s.removeClass("kv-editable-processing")},a.on("submit",function(e){e.preventDefault()}),a.on("keyup",function(e){13==e.which&&n.trigger("click")}),a.on("reset",function(){setTimeout(function(){a.data("kvEditableSubmit",!1),g?(p.find(".help-block").remove(),p.removeClass("has-error")):(u.removeClass("has-error"),v.html(" ")),d.popoverX("refreshPosition")},200)}),a.find("input, select").on("change",function(){d.popoverX("refreshPosition"),f.trigger("editableChange",[f.val()])}),a.on("afterValidate",function(){}),l.on("click",function(){b.val(0),setTimeout(function(){a[0].reset()},200),f.trigger("editableReset")}),n.on("click",function(){s.addClass("kv-editable-processing"),c.show(),b.val(1),a.find("input, select").each(function(){var t=e(this);t.trigger("change")});var n="",l=r.$form.data("yiiActiveForm");e.ajax({type:a.attr("method"),url:a.attr("action"),data:a.serialize(),dataType:"json",error:function(e,t,i){r.showAjaxErrors&&o(i),f.trigger("editableAjaxError",[e,t,i])},success:function(b){var k=t(b.output)?r.$element.val():b.output,$=p.find(".kv-help-block");return d.popoverX("refreshPosition"),t(b.message)?(t($.attr("class"))||(u.removeClass("has-error"),$.html(""),$.hide(),v.html("")),a.find(".help-block").each(function(){return n=e(this).text(),t(n.trim())?void 0:void c.hide()}),t(n.trim())?(c.hide(),t(k)?k=h:!i(m)&&k in m&&(k=m[k]),g?(p.find(".help-block").remove(),p.removeClass("has-error"),v.html(""),d.popoverX("hide"),r.$value.html(k)):(u.removeClass("has-error"),v.html(""),d.popoverX("hide"),r.$value.html(k),void 0!=l&&(a.yiiActiveForm("destroy"),a.yiiActiveForm(l.attributes,l.settings))),f.trigger("editableSuccess",[f.val()])):f.trigger("editableError",[f.val()]),void s.removeClass("kv-editable-processing")):(o(b.message),void f.trigger("editableError",[f.val()]))}}),f.trigger("editableSubmit",[f.val()])})}},e.fn.editable=function(t){var i=Array.apply(null,arguments);return i.shift(),this.each(function(){var r=e(this),a=r.data("editable"),n="object"==typeof t&&t;a||r.data("editable",a=new o(this,e.extend({},e.fn.editable.defaults,n,e(this).data()))),"string"==typeof t&&a[t].apply(a,i)})},e.fn.editable.defaults={containerId:"",valueIfNull:"<em>(not set)</em>",placement:"right",displayValueConfig:{},showAjaxErrors:!0}}(window.jQuery);